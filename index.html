<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词记忆系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid #3498db;
            color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .word-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3498db;
        }
        
        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .word {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .pronunciation {
            color: #7f8c8d;
            font-style: italic;
        }
        
        .meaning {
            font-size: 18px;
            color: #34495e;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .progress-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.5s;
        }
        
        .test-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .test-option {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-option:hover {
            background: #f8f9fa;
        }
        
        .test-option.correct {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        .test-option.incorrect {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }
        
        .stat-item {
            flex: 1;
            padding: 15px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .word {
                font-size: 20px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>单词记忆系统</h1>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">学习</div>
            <div class="tab" data-tab="review">复习</div>
            <div class="tab" data-tab="upload">上传词库</div>
            <div class="tab" data-tab="stats">统计</div>
        </div>
        
        <div class="tab-content active" id="learn">
            <div class="progress-bar">
                <div class="progress" id="learn-progress"></div>
            </div>
            <div id="word-cards"></div>
            <div class="btn-group">
                <button class="btn" id="prev-btn">上一组</button>
                <button class="btn" id="next-btn">下一组</button>
                <button class="btn" id="test-btn">开始测试</button>
            </div>
        </div>
        
        <div class="tab-content" id="review">
            <div id="review-cards"></div>
            <div class="btn-group">
                <button class="btn" id="review-prev">上一个</button>
                <button class="btn" id="review-next">下一个</button>
            </div>
        </div>
        
        <div class="tab-content" id="upload">
            <div class="upload-area" id="upload-area">
                <p>点击或拖拽文件到这里上传词库</p>
                <p>支持格式：CSV (单词,发音,中文释义)</p>
            </div>
            <input type="file" id="file-input" accept=".csv" style="display: none;">
            <div id="upload-status"></div>
        </div>
        
        <div class="tab-content" id="stats">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-words">0</div>
                    <div class="stat-label">总单词数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="learned-words">0</div>
                    <div class="stat-label">已学单词</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="review-words">0</div>
                    <div class="stat-label">待复习</div>
                </div>
            </div>
            <div id="stats-details"></div>
        </div>
    </div>

    <script>
        // 单词管理系统
        class WordManager {
            constructor() {
                this.words = [];
                this.currentGroup = 0;
                this.currentWordIndex = 0;
                this.reviewWords = [];
                this.learnedWords = [];
                this.testMode = false;
                this.currentTestWords = [];
                this.testIndex = 0;
                this.testCorrect = 0;
                this.testTotal = 0;
                
                // 艾宾浩斯遗忘曲线复习间隔（天）
                this.reviewIntervals = [1, 2, 3, 5, 7, 9, 12, 14, 17, 21];
                
                this.loadData();
            }
            
            // 加载数据
            loadData() {
                const savedWords = localStorage.getItem('wordManager_words');
                const savedLearned = localStorage.getItem('wordManager_learned');
                const savedReview = localStorage.getItem('wordManager_review');
                
                if (savedWords) {
                    this.words = JSON.parse(savedWords);
                }
                
                if (savedLearned) {
                    this.learnedWords = JSON.parse(savedLearned);
                }
                
                if (savedReview) {
                    this.reviewWords = JSON.parse(savedReview);
                }
            }
            
            // 保存数据
            saveData() {
                localStorage.setItem('wordManager_words', JSON.stringify(this.words));
                localStorage.setItem('wordManager_learned', JSON.stringify(this.learnedWords));
                localStorage.setItem('wordManager_review', JSON.stringify(this.reviewWords));
            }
            
            // 上传词库
            uploadWords(csvText) {
                const lines = csvText.split('\n');
                this.words = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const parts = line.split(',');
                        if (parts.length >= 3) {
                            this.words.push({
                                word: parts[0].trim(),
                                pronunciation: parts[1].trim(),
                                meaning: parts[2].trim(),
                                learned: false,
                                reviewDates: [],
                                lastReviewed: null
                            });
                        }
                    }
                }
                
                this.saveData();
                return this.words.length;
            }
            
            // 获取当前学习组的单词
            getCurrentGroupWords() {
                const startIndex = this.currentGroup * 5;
                return this.words.slice(startIndex, startIndex + 5);
            }
            
            // 获取下一组单词
            nextGroup() {
                if ((this.currentGroup + 1) * 5 < this.words.length) {
                    this.currentGroup++;
                    return this.getCurrentGroupWords();
                }
                return null;
            }
            
            // 获取上一组单词
            prevGroup() {
                if (this.currentGroup > 0) {
                    this.currentGroup--;
                    return this.getCurrentGroupWords();
                }
                return null;
            }
            
            // 标记单词为已学习
            markWordAsLearned(wordIndex) {
                const word = this.words[wordIndex];
                if (word && !word.learned) {
                    word.learned = true;
                    word.lastReviewed = new Date().toISOString();
                    
                    // 添加复习计划
                    this.scheduleReviews(wordIndex);
                    
                    this.saveData();
                }
            }
            
            // 安排复习
            scheduleReviews(wordIndex) {
                const word = this.words[wordIndex];
                if (!word) return;
                
                const today = new Date();
                word.reviewDates = [];
                
                for (const interval of this.reviewIntervals) {
                    const reviewDate = new Date(today);
                    reviewDate.setDate(today.getDate() + interval);
                    word.reviewDates.push(reviewDate.toISOString().split('T')[0]);
                }
                
                // 添加到复习列表
                this.addToReviewList(wordIndex);
            }
            
            // 添加到复习列表
            addToReviewList(wordIndex) {
                const word = this.words[wordIndex];
                if (!word) return;
                
                // 检查是否已经在复习列表中
                const existingIndex = this.reviewWords.findIndex(item => item.wordIndex === wordIndex);
                if (existingIndex === -1) {
                    this.reviewWords.push({
                        wordIndex: wordIndex,
                        nextReviewDate: word.reviewDates[0]
                    });
                }
                
                this.saveData();
            }
            
            // 获取今天需要复习的单词
            getTodayReviewWords() {
                const today = new Date().toISOString().split('T')[0];
                return this.reviewWords
                    .filter(item => item.nextReviewDate <= today)
                    .map(item => {
                        return {
                            ...this.words[item.wordIndex],
                            wordIndex: item.wordIndex
                        };
                    });
            }
            
            // 完成复习
            completeReview(wordIndex) {
                const word = this.words[wordIndex];
                if (!word) return;
                
                // 找到当前复习日期在复习计划中的位置
                const today = new Date().toISOString().split('T')[0];
                const currentReviewIndex = word.reviewDates.findIndex(date => date === today);
                
                if (currentReviewIndex !== -1 && currentReviewIndex < word.reviewDates.length - 1) {
                    // 更新下一次复习日期
                    const reviewItem = this.reviewWords.find(item => item.wordIndex === wordIndex);
                    if (reviewItem) {
                        reviewItem.nextReviewDate = word.reviewDates[currentReviewIndex + 1];
                    }
                } else {
                    // 所有复习完成，从复习列表中移除
                    this.reviewWords = this.reviewWords.filter(item => item.wordIndex !== wordIndex);
                }
                
                word.lastReviewed = new Date().toISOString();
                this.saveData();
            }
            
            // 开始测试
            startTest() {
                this.testMode = true;
                this.testIndex = 0;
                this.testCorrect = 0;
                this.testTotal = 5; // 每组5个单词测试
                
                // 获取当前组的单词
                const currentWords = this.getCurrentGroupWords();
                this.currentTestWords = [...currentWords];
                
                // 打乱顺序
                this.shuffleArray(this.currentTestWords);
                
                return this.currentTestWords;
            }
            
            // 检查测试答案
            checkTestAnswer(wordIndex, selectedMeaning) {
                const word = this.currentTestWords[wordIndex];
                if (word.meaning === selectedMeaning) {
                    this.testCorrect++;
                    return true;
                }
                return false;
            }
            
            // 完成测试
            completeTest() {
                // 标记所有单词为已学习
                const currentWords = this.getCurrentGroupWords();
                for (const word of currentWords) {
                    const wordIndex = this.words.findIndex(w => w.word === word.word);
                    if (wordIndex !== -1) {
                        this.markWordAsLearned(wordIndex);
                    }
                }
                
                this.testMode = false;
                return {
                    correct: this.testCorrect,
                    total: this.testTotal
                };
            }
            
            // 辅助函数：打乱数组
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // 获取统计信息
            getStats() {
                const totalWords = this.words.length;
                const learnedWords = this.words.filter(word => word.learned).length;
                const todayReviewWords = this.getTodayReviewWords().length;
                
                return {
                    totalWords,
                    learnedWords,
                    todayReviewWords
                };
            }
        }

        // 初始化单词管理器
        const wordManager = new WordManager();
        
        // DOM元素
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const wordCardsContainer = document.getElementById('word-cards');
        const reviewCardsContainer = document.getElementById('review-cards');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const testBtn = document.getElementById('test-btn');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const uploadStatus = document.getElementById('upload-status');
        const learnProgress = document.getElementById('learn-progress');
        const totalWordsElem = document.getElementById('total-words');
        const learnedWordsElem = document.getElementById('learned-words');
        const reviewWordsElem = document.getElementById('review-words');
        const statsDetails = document.getElementById('stats-details');
        const reviewPrevBtn = document.getElementById('review-prev');
        const reviewNextBtn = document.getElementById('review-next');
        
        // 当前复习单词索引
        let currentReviewIndex = 0;
        
        // 标签切换
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // 更新活动标签
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // 更新活动内容
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                        
                        // 加载特定标签的内容
                        if (tabId === 'learn') {
                            loadLearningContent();
                        } else if (tabId === 'review') {
                            loadReviewContent();
                        } else if (tabId === 'stats') {
                            loadStatsContent();
                        }
                    }
                });
            });
        });
        
        // 加载学习内容
        function loadLearningContent() {
            const currentWords = wordManager.getCurrentGroupWords();
            displayWordCards(currentWords);
            updateProgress();
        }
        
        // 显示单词卡片
        function displayWordCards(words) {
            wordCardsContainer.innerHTML = '';
            
            if (words.length === 0) {
                wordCardsContainer.innerHTML = '<p>没有单词可学习，请先上传词库。</p>';
                return;
            }
            
            words.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'word-card';
                card.innerHTML = `
                    <div class="word-header">
                        <div class="word">${word.word}</div>
                        <div class="pronunciation">${word.pronunciation}</div>
                    </div>
                    <div class="meaning">${word.meaning}</div>
                `;
                wordCardsContainer.appendChild(card);
            });
        }
        
        // 更新进度条
        function updateProgress() {
            const totalGroups = Math.ceil(wordManager.words.length / 5);
            const progress = ((wordManager.currentGroup + 1) / totalGroups) * 100;
            learnProgress.style.width = `${progress}%`;
        }
        
        // 上一组单词
        prevBtn.addEventListener('click', () => {
            const words = wordManager.prevGroup();
            if (words) {
                displayWordCards(words);
                updateProgress();
            }
        });
        
        // 下一组单词
        nextBtn.addEventListener('click', () => {
            const words = wordManager.nextGroup();
            if (words) {
                displayWordCards(words);
                updateProgress();
            }
        });
        
        // 开始测试
        testBtn.addEventListener('click', () => {
            const testWords = wordManager.startTest();
            displayTest(testWords);
        });
        
        // 显示测试
        function displayTest(words) {
            wordCardsContainer.innerHTML = '';
            
            words.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'word-card';
                card.innerHTML = `
                    <div class="word-header">
                        <div class="word">${word.word}</div>
                        <div class="pronunciation">${word.pronunciation}</div>
                    </div>
                    <p>请选择正确的中文释义：</p>
                    <div class="test-options" id="options-${index}">
                        <!-- 选项将通过JavaScript动态生成 -->
                    </div>
                `;
                wordCardsContainer.appendChild(card);
                
                // 生成选项
                const optionsContainer = document.getElementById(`options-${index}`);
                const options = generateOptions(words, index);
                
                options.forEach(option => {
                    const optionElem = document.createElement('div');
                    optionElem.className = 'test-option';
                    optionElem.textContent = option;
                    optionElem.addEventListener('click', () => {
                        // 检查答案
                        const isCorrect = wordManager.checkTestAnswer(index, option);
                        
                        // 显示结果
                        if (isCorrect) {
                            optionElem.classList.add('correct');
                        } else {
                            optionElem.classList.add('incorrect');
                            // 显示正确答案
                            const correctOption = optionsContainer.querySelector(`[data-meaning="${word.meaning}"]`);
                            if (correctOption) {
                                correctOption.classList.add('correct');
                            }
                        }
                        
                        // 禁用所有选项
                        const allOptions = optionsContainer.querySelectorAll('.test-option');
                        allOptions.forEach(opt => {
                            opt.style.pointerEvents = 'none';
                        });
                    });
                    
                    // 添加数据属性以便找到正确答案
                    if (option === word.meaning) {
                        optionElem.setAttribute('data-meaning', word.meaning);
                    }
                    
                    optionsContainer.appendChild(optionElem);
                });
            });
            
            // 更新按钮
            testBtn.textContent = '完成测试';
            testBtn.removeEventListener('click', testBtn.click);
            testBtn.addEventListener('click', completeTest);
        }
        
        // 生成测试选项
        function generateOptions(words, currentIndex) {
            const currentWord = words[currentIndex];
            const options = [currentWord.meaning];
            
            // 添加其他单词的释义作为干扰项
            for (let i = 0; i < words.length; i++) {
                if (i !== currentIndex && options.length < 4) {
                    options.push(words[i].meaning);
                }
            }
            
            // 如果选项不足4个，添加一些随机选项
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * words.length);
                if (!options.includes(words[randomIndex].meaning)) {
                    options.push(words[randomIndex].meaning);
                }
            }
            
            // 打乱选项顺序
            return wordManager.shuffleArray(options);
        }
        
        // 完成测试
        function completeTest() {
            const result = wordManager.completeTest();
            alert(`测试完成！正确率：${result.correct}/${result.total}`);
            
            // 重置按钮
            testBtn.textContent = '开始测试';
            testBtn.removeEventListener('click', completeTest);
            testBtn.addEventListener('click', () => {
                const testWords = wordManager.startTest();
                displayTest(testWords);
            });
            
            // 返回学习模式
            loadLearningContent();
        }
        
        // 上传词库
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '#f0f8ff';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.backgroundColor = '';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        function handleFileUpload(file) {
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                uploadStatus.innerHTML = '<p style="color: red;">请上传CSV格式的文件</p>';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const csvText = e.target.result;
                const wordCount = wordManager.uploadWords(csvText);
                uploadStatus.innerHTML = `<p style="color: green;">成功上传 ${wordCount} 个单词</p>`;
                
                // 更新学习内容
                loadLearningContent();
            };
            reader.readAsText(file);
        }
        
        // 加载复习内容
        function loadReviewContent() {
            const reviewWords = wordManager.getTodayReviewWords();
            currentReviewIndex = 0;
            
            if (reviewWords.length === 0) {
                reviewCardsContainer.innerHTML = '<p>今天没有需要复习的单词！</p>';
                reviewPrevBtn.style.display = 'none';
                reviewNextBtn.style.display = 'none';
                return;
            }
            
            reviewPrevBtn.style.display = 'inline-block';
            reviewNextBtn.style.display = 'inline-block';
            
            displayReviewWord(currentReviewIndex, reviewWords);
        }
        
        // 显示复习单词
        function displayReviewWord(index, words) {
            reviewCardsContainer.innerHTML = '';
            
            const word = words[index];
            const card = document.createElement('div');
            card.className = 'word-card';
            card.innerHTML = `
                <div class="word-header">
                    <div class="word">${word.word}</div>
                    <div class="pronunciation">${word.pronunciation}</div>
                </div>
                <div class="meaning hidden">${word.meaning}</div>
                <button class="btn" id="show-meaning">显示释义</button>
                <div class="btn-group" style="margin-top: 15px;">
                    <button class="btn" id="remember-btn">记住了</button>
                    <button class="btn" id="forget-btn">没记住</button>
                </div>
            `;
            reviewCardsContainer.appendChild(card);
            
            // 显示释义
            document.getElementById('show-meaning').addEventListener('click', () => {
                document.querySelector('.meaning').classList.remove('hidden');
            });
            
            // 记住按钮
            document.getElementById('remember-btn').addEventListener('click', () => {
                wordManager.completeReview(word.wordIndex);
                if (index < words.length - 1) {
                    currentReviewIndex++;
                    displayReviewWord(currentReviewIndex, words);
                } else {
                    reviewCardsContainer.innerHTML = '<p>今天的复习已完成！</p>';
                    reviewPrevBtn.style.display = 'none';
                    reviewNextBtn.style.display = 'none';
                }
            });
            
            // 没记住按钮
            document.getElementById('forget-btn').addEventListener('click', () => {
                // 只是显示下一个单词，不标记为完成
                if (index < words.length - 1) {
                    currentReviewIndex++;
                    displayReviewWord(currentReviewIndex, words);
                } else {
                    reviewCardsContainer.innerHTML = '<p>今天的复习已完成！</p>';
                    reviewPrevBtn.style.display = 'none';
                    reviewNextBtn.style.display = 'none';
                }
            });
        }
        
        // 复习上一个单词
        reviewPrevBtn.addEventListener('click', () => {
            const reviewWords = wordManager.getTodayReviewWords();
            if (currentReviewIndex > 0) {
                currentReviewIndex--;
                displayReviewWord(currentReviewIndex, reviewWords);
            }
        });
        
        // 复习下一个单词
        reviewNextBtn.addEventListener('click', () => {
            const reviewWords = wordManager.getTodayReviewWords();
            if (currentReviewIndex < reviewWords.length - 1) {
                currentReviewIndex++;
                displayReviewWord(currentReviewIndex, reviewWords);
            }
        }
        
        // 加载统计内容
        function loadStatsContent() {
            const stats = wordManager.getStats();
            
            totalWordsElem.textContent = stats.totalWords;
            learnedWordsElem.textContent = stats.learnedWords;
            reviewWordsElem.textContent = stats.todayReviewWords;
            
            // 显示详细统计
            statsDetails.innerHTML = `
                <h3>学习进度</h3>
                <p>总单词数: ${stats.totalWords}</p>
                <p>已学习: ${stats.learnedWords}</p>
                <p>学习进度: ${stats.totalWords > 0 ? Math.round((stats.learnedWords / stats.totalWords) * 100) : 0}%</p>
                <p>今日需复习: ${stats.todayReviewWords} 个单词</p>
            `;
        }
        
        // 初始化
        loadLearningContent();
    </script>
</body>
</html>
